# circom-rangeproof-for-vc
circom circuits for rangeproof of birthdate described in Verifiable credentials

Do not use this repository as it is for experimental purposes.


##Getting started  

```
git clone https://github.com/kskhasegawa/circom-rangeproof-for-vc.git
cd circom-rangeproof-for-vc
npm install
```

circuit compile  
```
circom circuits/hash_to_fr_to_commit_and_compare.circom --r1cs  --wasm -p bls12381
cd hash_to_fr_to_commit_and_compare_js
snarkjs powersoftau contribute pot16_0000.ptau pot16_0001.ptau --name="First contribution" -v
snarkjs powersoftau prepare phase2 pot16_0001.ptau pot16_final.ptau -v
snarkjs groth16 setup ../hash_to_fr_to_commit_and_compare.r1cs pot16_final.ptau hashAndCompare_0000.zkey
snarkjs zkey contribute hashAndCompare_0000.zkey hashAndCompare_0001.zkey --name="1st Contributor Name" -v
snarkjs zkey export verificationkey hashAndCompare_0001.zkey verification_key.json
```

input generation  
```
node generate_input.js statement.json input.json
```
statement.json is like below  
```
{
    "statement": "<did:example:b34ca6cd37bbf23> <http://schema.org/birthDate> \"1958-07-17\"^^<http://www.w3.org/2001/XMLSchema#dateTime> .",
    "proofChallenge": "07c15be749e0d9277b25b62ea2e02487822687644024f024a7e53ac43a449fe4",
    "blinding_factor": "2664991206cc6e6a144513f4c899a417ee516fa456ee3f9ec51c159ddca97c33",
    "target": [1990, 12, 31]
}
```

witness generation  
```
cd hash_to_fr_to_commit_and_compare_js
node generate_witness.js hash_to_fr_to_commit_and_compare.wasm ../input.json witness.wtns
```

prove  
```
snarkjs groth16 prove hashAndCompare_0001.zkey witness.wtns proof.json public.json
```

verify  
verify whether the date described in statement string is older than target or not, without showing plain text of the statement.  
```
snarkjs groth16 verify verification_key.json public.json proof.json
```


composit proof verify  
return true if the value of the commitment generated by this circom circuits is the same as that contained in VPdocument(proofValue).  
this allows us to relate the zk-snark proof to the VP proof.  
```
node /scripts check_commitment_in_proof.js example/VPdocument_example.json public.json
```